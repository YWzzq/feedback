# AI Feedback Tool

一个用于AI助手与用户交互的反馈循环工具，支持CLI和GUI两种模式。

## 📦 安装步骤

### 1. Clone项目到本地

```bash
git clone https://github.com/YWzzq/feedback.git
cd ai-feedback-tool
```
或者直接下载zip
**记住这个路径！** 例如：`C:/Users/hp/software/MCP/` 或 `/home/user/ai-feedback-tool/`

### 2. 安装依赖

```bash
pip install pillow
```

**依赖说明**：
- **CLI模式**：无需任何依赖，使用Python标准库
- **GUI模式**：需要 `pillow` 库（用于图片处理和粘贴功能）

### 3. 配置AI工具全局规则

在你使用的AI工具（如Windsurf、Cursor等）中，添加以下**全局规则**（Global Rules）：

**⚠️ 重要：将下面的路径 `C:/Users/hp/software/MCP/` 替换为你实际clone的项目路径！**

```markdown
# 🚨 AI必读：强制反馈循环规则

## 📋 标准工作流程（必须遵守）

### 步骤1：接收任务
```
用户在终端描述任务
→ 你接收到任务描述
```

### 步骤2：查看相关文件
```
根据任务描述，查看对应的文件
→ 理解任务的具体内容和背景
```

### 步骤3：制定任务列表
```
创建任务列表，包含：
- 任务1: [具体任务]
- 任务2: [具体任务]
- ...
- 任务N-1: [倒数第二个任务]
- 任务N: 调用反馈工具  ← 最后一个任务，必须是这个！
```

### 步骤4：执行任务1到N-1
```
按顺序执行所有任务（除了最后一个）
→ 完成具体工作
```

### 步骤5：输出任务总结
```
在执行最后一个任务之前，输出：
- 已完成的任务列表
- 每个任务的完成情况
- 工作成果摘要
```

### 步骤6：执行最后任务（调用反馈工具）
```
调用反馈工具
→ 停止输出
→ 等待用户反馈
```

### 步骤7：收到反馈后循环
```
收到用户反馈
→ 回到步骤1（如果有新任务）
→ 或回到步骤4（继续当前任务）
→ 重复流程
```

---

## 核心规则（3条）

### 1️⃣ 任务列表的最后一项 = 调用反馈工具
```
你的任务列表必须这样结构：
- 任务1: 分析代码
- 任务2: 修复问题
- 任务3: 运行测试
- 任务4: 调用反馈工具  ← 必须是最后一项！

然后：
1. 执行任务1-3
2. 输出总结："已完成任务1-3，现在调用反馈工具"
3. 执行任务4（调用反馈工具）
4. 停止，等待
```

### 2️⃣ 调用 = 等待
```
调用反馈工具后：
- ✅ 停止输出任何内容
- ✅ 等待反馈工具返回
- ❌ 不要继续说话
- ❌ 不要问"有什么可以帮忙"

必须设置：isBackground=false
```

### 3️⃣ 收到反馈 = 再次调用
```
处理完用户反馈后：
1. 根据反馈执行任务
2. 输出结果
3. 再次调用反馈工具  ← 循环！
4. 再次等待

直到用户在反馈中说 "end" 才停止
```

---

## 调用命令

```bash
python C:/Users/hp/software/MCP/ai_feedback_tool_blocking.py --gui --summary "你的任务摘要" --timeout 9999
```

**关键参数：** `isBackground=false`

---

## 记忆口诀

**"说完话 → 调工具 → 闭嘴等 → 收反馈 → 做任务 → 说完话 → 再调用 → ..."**

---

## 错误示例 ❌

```
你: "我完成了分析。"
你: (对话结束)  ← 错误！忘记调用反馈工具
```

```
你: "问题解决了。"
你: 调用反馈工具
你: "还有其他问题吗？"  ← 错误！不要继续输出
```

---

## 正确示例 ✅

```
你: "我完成了分析，结果是..."
你: 调用反馈工具
你: (停止，等待)
[用户在终端输入反馈]
你: "收到反馈，我继续优化..."
你: 调用反馈工具
你: (再次停止，等待)
[持续循环]
```

---

## 最重要的话

**每次回答的结尾，都要调用反馈工具！**
**这不是可选项，这是强制要求！**
**回答完 = 调用工具，无一例外！**
```

---

## ✨ 功能特性

- **双模式支持**:
  - **CLI模式**: 命令行交互，轻量快速，适合纯文本反馈
  - **GUI模式**: 图形界面，支持图片上传和粘贴（推荐）
- **图片支持** (GUI模式):
  - 📎 上传本地图片文件
  - 📋 Ctrl+V 智能粘贴剪贴板图片
  - 自动保存到`feedback/`目录
- **智能粘贴**: 自动识别剪贴板内容类型（图片/文本）
- **警告抑制**: 完全抑制libpng等C库警告，输出干净

---

## 🚀 使用方法

**推荐使用 `ai_feedback_tool_blocking.py`**（自动抑制stderr警告，输出更干净）

### CLI模式（纯文本交互）

```bash
python ai_feedback_tool_blocking.py --cli --summary "AI任务摘要"
```

**适用场景**：
- 快速文本反馈
- 无需图片说明
- 终端环境

### GUI模式（图文交互，推荐）

```bash
python ai_feedback_tool_blocking.py --gui --summary "AI任务摘要" --timeout 9999
```

**适用场景**：
- 需要上传截图、错误图片
- 需要标注问题位置
- 复杂的可视化反馈

---

## � 项目结构

```
.
├── ai_feedback_tool_simple.py   # 核心实现（CLI+GUI）
├── ai_feedback_tool_blocking.py # 推荐使用（抑制stderr警告）
├── feedback/                    # 图片自动保存目录（自动创建）
├── README.md
├── LICENSE
└── .gitignore
```

---

## 🔧 参数说明

| 参数 | 必选 | 说明 |
|------|------|------|
| `--cli` / `--gui` | ✅ | 选择CLI或GUI模式（二选一） |
| `--summary` / `-s` | ❌ | AI工作摘要，显示在界面顶部 |
| `--timeout` / `-t` | ❌ | 超时时间（秒），默认6000，建议设置9999 |

---


## 🎯 最佳实践

1. **优先使用GUI模式**：支持图片反馈，交互更直观
2. **设置长超时时间**：`--timeout 9999` 避免思考时间过长导致超时
3. **配置全局规则**：让AI自动调用反馈工具，形成完整的工作循环
4. **使用blocking版本**：`ai_feedback_tool_blocking.py` 输出更干净

---

## 📝 License

MIT License
